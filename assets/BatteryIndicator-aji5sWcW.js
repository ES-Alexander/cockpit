import{c as Z,t as J,u as K,e as ee,R as te,r as x,S as L,T as N,h as p,U as oe,w as le,W as ae,X as se,j as ne,m as u,n as d,q as s,E as i,p as l,P as g,v as b,x as V,z as a,B as C,Q as I,Y as ie,Z as re,G as ue,$ as de,V as R,a0 as U,a1 as T,a2 as me,a3 as A,a4 as S,a5 as k,a6 as pe,F as ce}from"./index-yH2KMP_r.js";const ve={key:0,class:"relative w-[1.5rem] battery-icon"},ge={key:0,class:"absolute text-sm text-white -bottom-[3px] left-[4px] mdi mdi-circle"},he={key:1,class:"absolute text-sm text-yellow-400 -bottom-[3px] left-[4px] mdi mdi-alert-circle"},fe={key:1,class:"relative flex flex-col justify-center items-center h-full w-[1.5rem] battery-icon"},xe={key:1,class:"absolute text-sm text-white bottom-0 left-0 mdi mdi-circle"},be={key:2,class:"absolute text-sm text-yellow-400 bottom-0 left-0 mdi mdi-alert-circle"},we={class:"relative right-0 flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end -mr-2"},ye={class:"w-full"},Ve={class:"flex justify-end gap-x-1 items-center"},Ce={class:"font-mono"},Te={class:"w-full"},Se={key:0,class:"flex justify-end gap-x-1 items-center"},ke={class:"font-mono mt-[2px]"},_e={key:1,class:"flex justify-end gap-x-1 items-center text-yellow-100"},Me={class:"font-mono mt-[2px]"},Ie={class:"absolute top-2 right-2 z-10"},Ue={class:"flex justify-between items-center -mt-1"},Be={class:"flex items-center gap-x-1"},We={class:"flex items-center gap-x-2"},je={class:"flex items-center gap-x-2"},De={class:"flex items-center gap-x-2"},Pe={class:"flex items-center gap-x-2"},Oe={class:"text-red-500 text-center text-sm w-[full]"},h=500,$e=Z({__name:"BatteryIndicator",props:{miniWidget:{}},setup(E){var O,F,z;const t=J(E).miniWidget,B={showCurrent:!0,showPower:!0,toggleInterval:1e3},r=K(),_=ee(),G=te(),w=x(!0),f=x(void 0),y=x(""),M=x(void 0),c=x(t.value.options.toggleInterval??B.toggleInterval);(O=t.value.options).useVoltageToColor??(O.useVoltageToColor=!1),(F=t.value.options).voltageToColorScheme??(F.voltageToColorScheme=Object.assign({},L)),(z=t.value.options).batteryThresholds??(z.batteryThresholds=Object.assign({},N));const v=p(()=>t.value.options.batteryThresholds),q=()=>{t.value.options.voltageToColorScheme=Object.assign({},L),t.value.options.batteryThresholds=Object.assign({},N)},W=p(()=>{var e;const n=(e=r==null?void 0:r.powerSupply)==null?void 0:e.voltage;return n==null?null:Math.abs(n)>=100?Math.round(n):Math.round(n*10)/10}),H=oe(W,4e3),j=p(()=>{const n=H.value;if(n==null)return"unknown";const{critical:e,low:o,medium:$}=v.value;return n<=e?"critical":n<=o?"low":n<=$?"medium":n>$?"high":"unknown"}),D=p(()=>{const n=j.value;return t.value.options.voltageToColorScheme[n]??"transparent"}),Q=p(()=>{const n=W.value;return n===null?"--":Math.abs(n)>=100?n.toFixed(0):n.toFixed(1)}),X=p(()=>{var n;return((n=r==null?void 0:r.powerSupply)==null?void 0:n.current)===void 0?"--":Math.abs(r.powerSupply.current)>=100?r.powerSupply.current.toFixed(0):r.powerSupply.current.toFixed(1)}),Y=p(()=>r.instantaneousWatts!==void 0?r.instantaneousWatts.toFixed(1):"--"),m=p(()=>{var n;return((n=r==null?void 0:r.powerSupply)==null?void 0:n.remaining)===void 0?-1:Math.abs(r.powerSupply.remaining)>100?100:r.powerSupply.remaining}),P=()=>{(f.value||M.value)&&(clearInterval(f.value),clearTimeout(M.value)),c.value<h?(t.value.options.toggleInterval=h,y.value=`Interval must be at least ${h}ms.`):t.value.options.toggleInterval=c.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,y.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?f.value=setInterval(()=>{w.value=!w.value},t.value.options.toggleInterval):w.value=t.value.options.showCurrent,M.value=setTimeout(()=>{y.value="",c.value<h&&(c.value=h)},5e3)};return le([()=>t.value.options,c],P,{deep:!0}),ae(()=>{t.value.options=Object.assign({},B,t.value.options),P(),se.registerUsage("Instantaneous Watts")}),ne(()=>{f.value===void 0&&clearInterval(f.value)}),(n,e)=>(d(),u(ce,null,[s(I,{text:`Battery remaining: ${m.value<0?"No Data":m.value+"%"}`},{activator:i(({props:o})=>[l("div",g(o,{class:"flex items-center w-[95px] h-12 text-white justify-center"}),[m.value>=0?(d(),u("div",ve,[e[13]||(e[13]=l("i",{class:"mdi mdi-battery-outline"},null,-1)),l("i",{class:"mdi mdi-battery absolute inset-0 bottom-0 -right-1 text-transparent bg-clip-text",style:V({backgroundImage:`linear-gradient(to top, white ${m.value}%, transparent ${m.value}%)`})},null,4),m.value<0?(d(),u("span",ge)):b("",!0),m.value<0?(d(),u("span",he)):b("",!0)])):(d(),u("div",fe,[l("i",{class:"absolute mdi mdi-battery",style:V({color:a(t).options.useVoltageToColor?D.value:"transparent"})},null,4),j.value==="critical"&&a(t).options.useVoltageToColor?(d(),u("i",{key:0,class:"absolute mdi mdi-battery animate-ping",style:V({color:D.value})},null,4)):b("",!0),e[14]||(e[14]=l("i",{class:"absolute mdi mdi-battery-outline text-[#CCCCCC88]"},null,-1)),m.value<0?(d(),u("span",xe)):b("",!0),m.value<0?(d(),u("span",be)):b("",!0)])),l("div",we,[l("div",ye,[l("div",Ve,[l("span",Ce,C(Q.value),1),e[15]||(e[15]=l("div",{class:"w-[15px] mr-[1px] -ml-[1px]"},"V",-1))])]),l("div",Te,[w.value?(d(),u("div",Se,[l("span",ke,C(X.value),1),e[16]||(e[16]=l("div",{class:"w-[15px]"},"A",-1))])):(d(),u("div",_e,[l("span",Me,C(Y.value),1),e[17]||(e[17]=l("div",{class:"w-[15px]"},"W",-1))]))])])],16)]),_:1},8,["text"]),s(pe,{modelValue:a(_).miniWidgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":e[12]||(e[12]=o=>a(_).miniWidgetManagerVars(a(t).hash).configMenuOpen=o),width:"auto"},{default:i(()=>[s(ie,{class:"pa-4 text-white w-[400px]",style:V([{"border-radius":"15px"},a(G).globalGlassMenuStyles])},{default:i(()=>[s(re,{class:"text-center"},{default:i(()=>e[18]||(e[18]=[ue("Battery Indicator Config")])),_:1,__:[18]}),s(de,{class:"flex flex-col gap-y-4"},{default:i(()=>[l("div",Ie,[s(R,{icon:"",size:"30",variant:"text",class:"text-white text-[22px]","aria-label":"Close",onClick:e[0]||(e[0]=o=>a(_).miniWidgetManagerVars(a(t).hash).configMenuOpen=!1)},{default:i(()=>e[19]||(e[19]=[l("i",{class:"mdi mdi-close"},null,-1)])),_:1,__:[19]})]),s(U,{modelValue:a(t).options.showCurrent,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).options.showCurrent=o),label:"Show Current","hide-details":"",class:"-mb-5"},null,8,["modelValue"]),s(U,{modelValue:a(t).options.showPower,"onUpdate:modelValue":e[2]||(e[2]=o=>a(t).options.showPower=o),label:"Show Power","hide-details":""},null,8,["modelValue"]),s(T,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:h,step:"100",density:"compact",variant:"outlined","hide-details":"",disabled:!a(t).options.showCurrent||!a(t).options.showPower},null,8,["modelValue","disabled"]),s(me,{class:"mt-2"}),l("div",Ue,[s(U,{modelValue:a(t).options.useVoltageToColor,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).options.useVoltageToColor=o),label:"Color icon by voltage","hide-details":"",class:"mr-1"},null,8,["modelValue"]),l("div",Be,[s(I,{location:"top",text:"Configure these voltage levels according to your battery pack. Defaults are based on Blue Robotics' 4S Li-ion battery pack."},{activator:i(({props:o})=>[s(A,g(o,{icon:"mdi-information-outline",class:"ml-1 text-yellow-300 cursor-pointer",size:"18"}),null,16)]),_:1}),s(I,{location:"top",text:"Reset colors and voltage thresholds to default values"},{activator:i(({props:o})=>[s(R,g(o,{icon:"",size:"small",variant:"text",class:"text-white",onClick:q}),{default:i(()=>[s(A,{icon:"mdi-restore",size:"18"})]),_:2},1040)]),_:1})])]),l("div",We,[e[20]||(e[20]=l("div",{class:"flex-1 text-sm"},"High battery",-1)),s(S,{"close-on-content-click":!1},{activator:i(({props:o})=>[l("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:a(t).options.voltageToColorScheme.high}}),null,16)]),default:i(()=>[s(k,{modelValue:a(t).options.voltageToColorScheme.high,"onUpdate:modelValue":e[5]||(e[5]=o=>a(t).options.voltageToColorScheme.high=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),l("div",je,[s(T,{modelValue:v.value.medium,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value.medium=o),modelModifiers:{number:!0},label:"Medium threshold (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),s(S,{"close-on-content-click":!1},{activator:i(({props:o})=>[l("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:a(t).options.voltageToColorScheme.medium}}),null,16)]),default:i(()=>[s(k,{modelValue:a(t).options.voltageToColorScheme.medium,"onUpdate:modelValue":e[7]||(e[7]=o=>a(t).options.voltageToColorScheme.medium=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),l("div",De,[s(T,{modelValue:v.value.low,"onUpdate:modelValue":e[8]||(e[8]=o=>v.value.low=o),modelModifiers:{number:!0},label:"Low threshold (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),s(S,{"close-on-content-click":!1},{activator:i(({props:o})=>[l("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:a(t).options.voltageToColorScheme.low}}),null,16)]),default:i(()=>[s(k,{modelValue:a(t).options.voltageToColorScheme.low,"onUpdate:modelValue":e[9]||(e[9]=o=>a(t).options.voltageToColorScheme.low=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),l("div",Pe,[s(T,{modelValue:v.value.critical,"onUpdate:modelValue":e[10]||(e[10]=o=>v.value.critical=o),modelModifiers:{number:!0},label:"Critical threshold (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),s(S,{"close-on-content-click":!1},{activator:i(({props:o})=>[l("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:a(t).options.voltageToColorScheme.critical}}),null,16)]),default:i(()=>[s(k,{modelValue:a(t).options.voltageToColorScheme.critical,"onUpdate:modelValue":e[11]||(e[11]=o=>a(t).options.voltageToColorScheme.critical=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),l("p",Oe,C(y.value),1)]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{$e as default};
