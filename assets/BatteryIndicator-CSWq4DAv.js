import{c as q,t as H,u as Q,e as X,R as Y,r as b,S as Z,T as J,h as p,U as K,w as ee,W as te,X as oe,j as le,m as u,n as d,q as n,E as r,p as a,P as g,v as w,x as V,z as l,B as C,Q as z,Y as ae,Z as se,G as ne,$ as ie,V as re,a0 as I,a1 as S,a2 as ue,a3 as de,a4 as T,a5 as k,a6 as me,F as pe}from"./index-BS3K_BEl.js";const ce={key:0,class:"relative w-[1.5rem] battery-icon"},ve={key:0,class:"absolute text-sm text-white -bottom-[3px] left-[4px] mdi mdi-circle"},ge={key:1,class:"absolute text-sm text-yellow-400 -bottom-[3px] left-[4px] mdi mdi-alert-circle"},he={key:1,class:"relative flex flex-col justify-center items-center h-full w-[1.5rem] battery-icon"},fe={key:1,class:"absolute text-sm text-white bottom-0 left-0 mdi mdi-circle"},be={key:2,class:"absolute text-sm text-yellow-400 bottom-0 left-0 mdi mdi-alert-circle"},we={class:"relative right-0 flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end -mr-2"},xe={class:"w-full"},ye={class:"flex justify-end gap-x-1 items-center"},Ve={class:"font-mono"},Ce={class:"w-full"},Se={key:0,class:"flex justify-end gap-x-1 items-center"},Te={class:"font-mono mt-[2px]"},ke={key:1,class:"flex justify-end gap-x-1 items-center text-yellow-100"},Me={class:"font-mono mt-[2px]"},_e={class:"absolute top-2 right-2 z-10"},Ie={class:"flex justify-between items-center -mt-1"},Ue={class:"flex items-center gap-x-2"},Be={class:"flex items-center gap-x-2"},We={class:"flex items-center gap-x-2"},Pe={class:"flex items-center gap-x-2"},je={class:"text-red-500 text-center text-sm w-[full]"},h=500,Oe=q({__name:"BatteryIndicator",props:{miniWidget:{}},setup(L){var D,F,O;const t=H(L).miniWidget,U={showCurrent:!0,showPower:!0,toggleInterval:1e3},i=Q(),M=X(),N=Y(),x=b(!0),f=b(void 0),y=b(""),_=b(void 0),c=b(t.value.options.toggleInterval??U.toggleInterval);(D=t.value.options).useVoltageToColor??(D.useVoltageToColor=!1),(F=t.value.options).voltageToColorScheme??(F.voltageToColorScheme=Object.assign({},Z)),(O=t.value.options).batteryThresholds??(O.batteryThresholds=Object.assign({},J));const v=p(()=>t.value.options.batteryThresholds),B=p(()=>{var e;const s=(e=i==null?void 0:i.powerSupply)==null?void 0:e.voltage;return s==null?null:Math.abs(s)>=100?Math.round(s):Math.round(s*10)/10}),A=K(B,4e3),W=p(()=>{const s=A.value;if(s==null)return"unknown";const{critical:e,low:o,medium:$}=v.value;return s<=e?"critical":s<=o?"low":s<=$?"medium":s>$?"high":"unknown"}),P=p(()=>{const s=W.value;return t.value.options.voltageToColorScheme[s]??"transparent"}),R=p(()=>{const s=B.value;return s===null?"--":Math.abs(s)>=100?s.toFixed(0):s.toFixed(1)}),E=p(()=>{var s;return((s=i==null?void 0:i.powerSupply)==null?void 0:s.current)===void 0?"--":Math.abs(i.powerSupply.current)>=100?i.powerSupply.current.toFixed(0):i.powerSupply.current.toFixed(1)}),G=p(()=>i.instantaneousWatts!==void 0?i.instantaneousWatts.toFixed(1):"--"),m=p(()=>{var s;return((s=i==null?void 0:i.powerSupply)==null?void 0:s.remaining)===void 0?-1:Math.abs(i.powerSupply.remaining)>100?100:i.powerSupply.remaining}),j=()=>{(f.value||_.value)&&(clearInterval(f.value),clearTimeout(_.value)),c.value<h?(t.value.options.toggleInterval=h,y.value=`Interval must be at least ${h}ms.`):t.value.options.toggleInterval=c.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,y.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?f.value=setInterval(()=>{x.value=!x.value},t.value.options.toggleInterval):x.value=t.value.options.showCurrent,_.value=setTimeout(()=>{y.value="",c.value<h&&(c.value=h)},5e3)};return ee([()=>t.value.options,c],j,{deep:!0}),te(()=>{t.value.options=Object.assign({},U,t.value.options),j(),oe.registerUsage("Instantaneous Watts")}),le(()=>{f.value===void 0&&clearInterval(f.value)}),(s,e)=>(d(),u(pe,null,[n(z,{text:`Battery remaining: ${m.value<0?"No Data":m.value+"%"}`},{activator:r(({props:o})=>[a("div",g(o,{class:"flex items-center w-[95px] h-12 text-white justify-center"}),[m.value>=0?(d(),u("div",ce,[e[13]||(e[13]=a("i",{class:"mdi mdi-battery-outline"},null,-1)),a("i",{class:"mdi mdi-battery absolute inset-0 bottom-0 -right-1 text-transparent bg-clip-text",style:V({backgroundImage:`linear-gradient(to top, white ${m.value}%, transparent ${m.value}%)`})},null,4),m.value<0?(d(),u("span",ve)):w("",!0),m.value<0?(d(),u("span",ge)):w("",!0)])):(d(),u("div",he,[a("i",{class:"absolute mdi mdi-battery",style:V({color:l(t).options.useVoltageToColor?P.value:"transparent"})},null,4),W.value==="critical"&&l(t).options.useVoltageToColor?(d(),u("i",{key:0,class:"absolute mdi mdi-battery animate-ping",style:V({color:P.value})},null,4)):w("",!0),e[14]||(e[14]=a("i",{class:"absolute mdi mdi-battery-outline text-[#CCCCCC88]"},null,-1)),m.value<0?(d(),u("span",fe)):w("",!0),m.value<0?(d(),u("span",be)):w("",!0)])),a("div",we,[a("div",xe,[a("div",ye,[a("span",Ve,C(R.value),1),e[15]||(e[15]=a("div",{class:"w-[15px] mr-[1px] -ml-[1px]"},"V",-1))])]),a("div",Ce,[x.value?(d(),u("div",Se,[a("span",Te,C(E.value),1),e[16]||(e[16]=a("div",{class:"w-[15px]"},"A",-1))])):(d(),u("div",ke,[a("span",Me,C(G.value),1),e[17]||(e[17]=a("div",{class:"w-[15px]"},"W",-1))]))])])],16)]),_:1},8,["text"]),n(me,{modelValue:l(M).miniWidgetManagerVars(l(t).hash).configMenuOpen,"onUpdate:modelValue":e[12]||(e[12]=o=>l(M).miniWidgetManagerVars(l(t).hash).configMenuOpen=o),width:"auto"},{default:r(()=>[n(ae,{class:"pa-4 text-white w-[400px]",style:V([{"border-radius":"15px"},l(N).globalGlassMenuStyles])},{default:r(()=>[n(se,{class:"text-center"},{default:r(()=>e[18]||(e[18]=[ne("Battery Indicator Config")])),_:1,__:[18]}),n(ie,{class:"flex flex-col gap-y-4"},{default:r(()=>[a("div",_e,[n(re,{icon:"",size:"30",variant:"text",class:"text-white text-[22px]","aria-label":"Close",onClick:e[0]||(e[0]=o=>l(M).miniWidgetManagerVars(l(t).hash).configMenuOpen=!1)},{default:r(()=>e[19]||(e[19]=[a("i",{class:"mdi mdi-close"},null,-1)])),_:1,__:[19]})]),n(I,{modelValue:l(t).options.showCurrent,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).options.showCurrent=o),label:"Show Current","hide-details":"",class:"-mb-5"},null,8,["modelValue"]),n(I,{modelValue:l(t).options.showPower,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).options.showPower=o),label:"Show Power","hide-details":""},null,8,["modelValue"]),n(S,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:h,step:"100",density:"compact",variant:"outlined","hide-details":"",disabled:!l(t).options.showCurrent||!l(t).options.showPower},null,8,["modelValue","disabled"]),n(ue,{class:"mt-2"}),a("div",Ie,[n(I,{modelValue:l(t).options.useVoltageToColor,"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).options.useVoltageToColor=o),label:"Use voltage to color scheme","hide-details":"",class:"mr-1"},null,8,["modelValue"]),n(z,{location:"top",text:"Configure these voltage levels according to your battery pack. Defaults are based on Blue Robotics' 4S Li-ion battery pack."},{activator:r(({props:o})=>[n(de,g(o,{icon:"mdi-information-outline",class:"ml-1 text-yellow-300 cursor-pointer",size:"18"}),null,16)]),_:1})]),a("div",Ue,[e[20]||(e[20]=a("div",{class:"flex-1 text-sm"},"High battery",-1)),n(T,{"close-on-content-click":!1},{activator:r(({props:o})=>[a("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:l(t).options.voltageToColorScheme.high}}),null,16)]),default:r(()=>[n(k,{modelValue:l(t).options.voltageToColorScheme.high,"onUpdate:modelValue":e[5]||(e[5]=o=>l(t).options.voltageToColorScheme.high=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),a("div",Be,[n(S,{modelValue:v.value.medium,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value.medium=o),modelModifiers:{number:!0},label:"Medium threshold (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),n(T,{"close-on-content-click":!1},{activator:r(({props:o})=>[a("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:l(t).options.voltageToColorScheme.medium}}),null,16)]),default:r(()=>[n(k,{modelValue:l(t).options.voltageToColorScheme.medium,"onUpdate:modelValue":e[7]||(e[7]=o=>l(t).options.voltageToColorScheme.medium=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),a("div",We,[n(S,{modelValue:v.value.low,"onUpdate:modelValue":e[8]||(e[8]=o=>v.value.low=o),modelModifiers:{number:!0},label:"Low threshold (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),n(T,{"close-on-content-click":!1},{activator:r(({props:o})=>[a("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:l(t).options.voltageToColorScheme.low}}),null,16)]),default:r(()=>[n(k,{modelValue:l(t).options.voltageToColorScheme.low,"onUpdate:modelValue":e[9]||(e[9]=o=>l(t).options.voltageToColorScheme.low=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),a("div",Pe,[n(S,{modelValue:v.value.critical,"onUpdate:modelValue":e[10]||(e[10]=o=>v.value.critical=o),modelModifiers:{number:!0},label:"Critical threshold (V)",type:"number",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"]),n(T,{"close-on-content-click":!1},{activator:r(({props:o})=>[a("div",g(o,{class:"w-8 h-8 rounded border border-white/30 cursor-pointer",style:{backgroundColor:l(t).options.voltageToColorScheme.critical}}),null,16)]),default:r(()=>[n(k,{modelValue:l(t).options.voltageToColorScheme.critical,"onUpdate:modelValue":e[11]||(e[11]=o=>l(t).options.voltageToColorScheme.critical=o),"hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1})]),a("p",je,C(y.value),1)]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{Oe as default};
